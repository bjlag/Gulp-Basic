# Gulp Basic

[TOC]

Базовый проект для разработки front-end, включающий в себя:

* Gulp 3
* Bower
* Bootstrap 3
* jQuery
* Normalize CSS
* Font Awesome
* SASS
* Autoprefixer
* Минификатор JS, CSS
* Оптимизатор изображений
* Генератор favicons
* Browsersync

## Структура проекта

```
gulp-basic/
├── dist/                           # Продакшен, команда gulp build --prod.
├── src/                            # Все ресурсы проекта.
│   ├── assets/                     # Обработанный CSS и JS, шрифты, картинки.
│   │   ├── css/  
│   │   ├── fonts/  
│   │   ├── images/  
│   │   └── js/  
│   ├── blocks/                     # SASS, исходный JS.
│   │   ├── block-one/              # Блок.
│   │   │   ├── block-one.sass
│   │   │   └── block-one.js
│   │   ├── block-two/
│   │   ├── _base.sass              # Базовые стили, которые должны быть в самом верху.
│   │   ├── _fonts.scss             # Импорт шрифтов.
│   │   ├── _var.scss               # Определяем переменные.
│   │   └── main.sass               # Главный SASS. Импортирует в себя другие блоки.
│   ├── favicons/                   # Ресурсы для генерации favicons.
│   │   ├── icons/                  # Иконки после генерации.
│   │   └── favicon-master.png      # Донер, из которого генерятся иконки.
│   ├── html/                       # HTML проекта.
│   │   ├── includes/               # Типовые блоки, которые подключаются в pages.
│   │   ├── layouts/                # Шаблоны страниц (пока не используется).
│   │   ├── pages/                  # Уникальные страницы.
│   │   ├── glob_vars.js            # Объявление глобальной переменной app.
│   │   └── main.js                 # Инициализация приложения.
│   ├── vendor/                     # Внешние библиотеки. Сюда же ставит Bower.
│   └── *.html                      # Готовый HTML, генерится в корень src.
├── .bowerrc
├── bower.json
├── gulpfile.js
└── package.json
```

## Старт

1. Глобальная установка Gulp:
    ```bash
    npm install --global gulp-cli
    ```

2. Установка зависимостей из файла `package.json`:
    ```bash
    npm install
    ```

3. Установка библиотек:
    ```bash
    bower install 
    ```

## Разработка

Вводим команду:
```bash
gulp build
```
Запустится задача `build` в режиме разработчика: 

* Поднимется `browser-sync`.
* Будут отслеживаться изменения в HTML, SASS и JS. При изменениях будет автоматически обновляться страница в браузере. 
* У CSS и JS будет строиться sourcemap.
* CSS и JS создаются в минифицированном и несжатом виде.

### Процесс разработки

* Верстаемые страницы создаются в папке `/src/html/pages`. 
* Повторяемые блоки можно перенести в `/src/html/includes` и подключать при необходимости конструкцией:
    ```
    @@include( '../includes/footer.html' )
    ```
    Возможны более сложные конструкции, подробнее [https://github.com/coderhaoxin/gulp-file-include](https://github.com/coderhaoxin/gulp-file-include).
* Готовые HTML страницы генерятся в корне папки `/src`.
* CSS пишется на SASS.
* CSS и JS пишутся в папке `/src/blocks`. Если используется БЭМ, то для удобства, каждый блок лучше хранить в отдельной папке. Блок, элементы и модификаторы пишутся в одном файле. JS относящийся к этому же блоку лучше хранить в той же папке, что и код стилей. Возможно применить и другой подход - главное SASS и JS писать в папке `/src/blocks`.

**Особенности:**

* После обработки SASS готовый CSS кладется в папку `/src/assets/css`.
* После обработки JS готовые скрипты кладутся в папку `/src/assets/js`.
* Используемые изображения размещать в папке `/src/assets/images`.
* Используемые шрифты размещать в папке `/src/assets/fonts`.
* CSS и JS создаются в минифицированном и несжатом виде. 
* Файлы `main.css и main.min.css` содержат основные стили. 
* Файлы `vendor.css и vendor.min.css` содержат вендорные стили. 
* Файлы `main.js и main.min.js` содержат основные скрипты. 
* Файлы `vendor.js и vendor.min.js` содержат вендорные скрипты. 
* В HTML, по умолчанию, подключаются минифицированные версии CSS и JS. 
* У минифицированных версий CSS и JS создаются sourcemap.

### Полезные задачи

**Разовая сборка HTML:** 
```bash
gulp html
```

**Разовая сборка CSS:**
```bash
gulp css:main       # для сборки основных стилей
gulp css:vendor     # для сборки вендорных стилей
```
 
**Разовая сборка JS:**
```bash
gulp js:main       # для сборки основных скриптов
gulp js:vendor     # для сборки вендорных скриптов
```

**Разовая сборка шрифтов:**
```bash
gulp fonts
```

## Продакшен

Вводим команду:
```bash
gulp build --prod
```
Запустится задача `build` в режиме продакшена:  

* Готовый HTML перенесется в корень папки `/dist`.
* У сгенерированного CSS и JS не строиться sourcemap.
* Все изображения из папки `/src/assets/images` оптимизируются и переносятся в `/dist/assets/images`. Исходные файлы в `/src/assets/images` не меняются.
* Все шрифты, JS, CSS генерятся в папку `/dist/assets`. 
* CSS и JS создаются в минифицированном и несжатом виде.

Если надо удалить папку dist выполните команду:
```bash
gulp clean:dist
```

Для ускорения повторной оптимизации изображений, результат предыдущей оптимизации кешируется. Чтобы очистить кеш, выполните команду:
```bash
gulp clean:cache
```

Если нужно только оптимизировать изображения для продакшена, выполните команду:
```bash
gulp images
```

## Генерация favicons

1. Подготовьте донора (мастер изображение), из которого будут создаваться иконки, и положите донора в папку `/src/favicons` с именем `favicon-master.png`.
2. В задаче `favicon:generate` укажите необходимые настройти, например, какие иконки надо создать (`ключ icons`).
3. Выполните команду:
    ```bash
    gulp favicon:generate
    ```
    
В результате:
1. Создадутся иконки, которые будут положены в папку `/src/assets/images/favicons`.
2. В папке `/src/html/includes` создастся файл `favicons.html`, который подключается в `/src/html/includes/head.html`. Данный файл будет содержать HTML код примерно такого вида:
    ```html
    <link rel="icon" type="image/png" sizes="32x32" href="assets/images/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/images/favicons/favicon-16x16.png">
    <link rel="shortcut icon" href="assets/images/favicons/favicon.ico">
    ```
    
**Для удаления иконок выполните команду:**
```bash
gulp clean:favicon
```

Задача `clean:favicon` всегда выполняется перед задачей `favicon:generate`.

## Настройка проекта

Все пути до необходимых ресурсов проекта указываются в ключах объекта `path` в файле `gulpfile.js`.

Что может потребоваться:
* `path.fonts.vendor` - подключить дополнительные вендорные шрифты.
* `path.css.vendor` - подключить дополнительные вендорные стили.
* `path.js.vendor` - подключить дополнительные вендорные скрипты.